CREATE TABLE `users` (
  `id`          bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `uid`         varchar(20)     NOT NULL COMMENT '对外 UID',
  `username`    varchar(30)     NOT NULL COMMENT '登录账号',
  `password`    varchar(95)     NOT NULL COMMENT 'bcrypt 哈希',
  `email`       varchar(100)    NOT NULL COMMENT '邮箱',
  `phone`       varchar(20)     DEFAULT NULL COMMENT '手机',
  `nickname`    varchar(50)     NOT NULL DEFAULT '' COMMENT '昵称',
  `avatar`      varchar(255)    DEFAULT '/static/avatar/default.png' COMMENT '头像',
  `role`        varchar(20)     NOT NULL DEFAULT 'reader' COMMENT '角色',
  `state`       tinyint         NOT NULL DEFAULT 1 COMMENT '1=正常 2=禁用 3=封禁',
  `deleted_at`  datetime        DEFAULT NULL COMMENT '软删除时间',
  `created_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `last_ip`     varchar(45)     DEFAULT NULL COMMENT '最后登录 IP',
  `last_at`     datetime        DEFAULT NULL COMMENT '最后登录时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_uid`      (`uid`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email`    (`email`),
  UNIQUE KEY `uk_phone`    (`phone`),
  KEY        `idx_state`   (`state`),
  KEY        `idx_deleted` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';